Kafka Cluster with Disaster Recovery
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π Apache Kafka –∫–ª–∞—Å—Ç–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Disaster Recovery (DR) –∏—Å–ø–æ–ª—å–∑—É—è Docker Compose.

> –î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–∏—Å–∞–ª—Å—è –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö, –¥–ª—è Yandex Prcticum –≤ –Ω–µ–º –º–Ω–æ–≥–æ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–æ–∫, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä—ã, –Ω–æ –Ω–µ —Å–∞–º—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é!
>> –†–∞–±–æ—Ç–∞ –≤—Å–µ–≥–¥–∞ –≤–µ–ª–∞—Å—å –≤ –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è, –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å 21 –ø–æ 00, –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ 
# –ó–∞–ø—É—Å–∫ 
```bash
docker-compose up -d
```
–ñ–¥–µ–º –ø–æ–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã

> –°–µ—Ä–≤–∏—Å—ã –Ω–µ –ø–∞–¥–∞—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Ö —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É
>  - shop-stoplist-producer
>  - client


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–í –∫–æ—Ä–Ω–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ tests —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–æ—Å–º–∞–Ω, –Ω–æ –æ–Ω–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ 

### Kafka
   - Apache Kafka
   - Kafka Connect
   - Kafka Streams
   - KSQL/ksqlDB

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
   - Docker
   - Docker Compose

### –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
   - Java 17+
   - Spring Boot
   - SQL
   - bash

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
   - Prometheus
   - Grafana
   - Alertmanager
   - Kafka Exporter
   - JMX Exporter

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
   - PostgreSQL
   - Kafka Streams

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
   - SSL/TLS
   - SASL/PLAIN
   - ACL
   - PKCS12/JKS

###  –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ API
   - Kafka UI
   - REST API
   - KSQL REST API


# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
Primary Cluster (–õ–æ–∫–∞–ª—å–Ω—ã–π)
–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: kafka-controller-0 (nodeId: 4000)

–ë—Ä–æ–∫–µ—Ä—ã:

kafka-0 (nodeId: 1000) - –ø–æ—Ä—Ç—ã 1090, 1091

kafka-1 (nodeId: 2000) - –ø–æ—Ä—Ç—ã 2090, 2091

UI: Kafka UI –Ω–∞ –ø–æ—Ä—Ç—É 8090

Schema Registry: –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 8081, 8082

DR Cluster (Disaster Recovery)
–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: kafka-controller-dr-0 (nodeId: 5000)

–ë—Ä–æ–∫–µ—Ä—ã:

kafka-dr-0 (nodeId: 3000) - –ø–æ—Ä—Ç—ã 3090, 3091

kafka-dr-1 (nodeId: 3100) - –ø–æ—Ä—Ç—ã 3190, 3191

UI: Kafka UI –Ω–∞ –ø–æ—Ä—Ç—É 8091

Schema Registry: –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 6081, 6082

–†–µ–ø–ª–∏–∫–∞—Ü–∏—è
MirrorMaker2: –†–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É primary –∏ DR –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
 
# –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
Docker

Docker Compose

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª Security)

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose up -d
```
–ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```bash
# –¢–æ–ª—å–∫–æ primary –∫–ª–∞—Å—Ç–µ—Ä
docker-compose up -d kafka-controller-0 kafka-0 kafka-1 kafka-ui

# –¢–æ–ª—å–∫–æ DR –∫–ª–∞—Å—Ç–µ—Ä
docker-compose up -d kafka-controller-dr-0 kafka-dr-0 kafka-dr-1 kafka-ui-dr

# Schema Registry
docker-compose up -d schema-registry schema-registry-dr
```
# MirrorMaker
docker-compose up -d mirror-maker
üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
Security Configuration
Authentication: SASL/PLAIN

Encryption: SSL/TLS

Authorization: StandardAuthorizer —Å ACL

Super User: admin/admin –∏–ª–∏  admin/Qwerty111

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Kafka
Primary Cluster
yaml
CLUSTER_ID: 'ciWo7IWazngRchmPES6q5A=='
KAFKA_PROCESS_ROLES: controller/broker
KAFKA_CONTROLLER_QUORUM_VOTERS: 4000@kafka-controller-0:4090
KAFKA_AUTO_CREATE_TOPICS_ENABLE: false
DR Cluster
yaml
CLUSTER_ID: 'drWo7IWazngRchmPES6q5B=='
KAFKA_PROCESS_ROLES: controller/broker
KAFKA_CONTROLLER_QUORUM_VOTERS: 5000@kafka-controller-dr-0:5090
KAFKA_AUTO_CREATE_TOPICS_ENABLE: true

## –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã
| –°–µ—Ä–≤–∏—Å             |	  –ü–æ—Ä—Ç   |     –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ     |
|--------------------|-----------|--------------------|
| kafka-0            | 1090      |	External listener |
| kafka-1            | 2090      |	External listener |
| kafka-dr-0         | 3090      |	External listener |
| kafka-dr-1         | 3190      |	External listener |
| kafka-ui           | 8090      |	Web Interface     |
| kafka-ui-dr        | 8091      |	Web Interface     |
| schema-registry    | 8081/8082 |	HTTP/HTTPS        |
| ksql-server        | 8088      | KSQL REST API     |
| schema-registry-dr | 6081/6082 |	HTTP/HTTPS        |
 

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
Kafka UI
Primary: http://localhost:8090

DR: http://localhost:8091

–î–æ—Å—Ç—É–ø —Å credentials: admin/admin

Health Checks
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–∫–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs kafka-0
docker-compose logs schema-registry
```

![img_4.png](img_4.png)

## –°–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
Prometheus - —Å–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
–ü–æ—Ä—Ç: 9090
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: .infra/prometheus/
Data: .infra/prometheus/prometheus_data/

Grafana - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
–ü–æ—Ä—Ç: 3000
–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: admin/admin
–î–∞—à–±–æ—Ä–¥—ã: .infra/grafana/dashboards/

Alertmanager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞–º–∏
–ü–æ—Ä—Ç: 9093
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: .infra/alertmanager/
Kafka Exporter - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ Kafka
–ü–æ—Ä—Ç: 9308

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º –±—Ä–æ–∫–µ—Ä–∞–º —Å SSL/SASL

```bash
# –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose up -d prometheus alertmanager grafana kafka-exporter

# –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
docker-compose up -d prometheus grafana kafka-exporter
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
Prometheus Targets: http://localhost:9090/targets
Grafana: http://localhost:3000 (admin/admin)
Alertmanager: http://localhost:9093
Kafka Exporter Metrics: http://localhost:9308/metrics

# Security
SSL Certificates
–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ./cert/:

text
cert/
‚îú‚îÄ‚îÄ controller-creds/
‚îÇ   ‚îú‚îÄ‚îÄ kafka.keystore.pkcs12
‚îÇ   ‚îú‚îÄ‚îÄ kafka.truststore.jks
‚îÇ   ‚îî‚îÄ‚îÄ kafka_server_jaas.conf
‚îî‚îÄ‚îÄ kafka-0-creds/
‚îú‚îÄ‚îÄ kafka.keystore.pkcs12  
‚îú‚îÄ‚îÄ kafka.truststore.jks
‚îî‚îÄ‚îÄ kafka_server_jaas.conf
JAAS Configuration
–ü—Ä–∏–º–µ—Ä kafka_server_jaas.conf:

text
KafkaServer {
org.apache.kafka.common.security.plain.PlainLoginModule required
username="admin"
password="admin"
user_admin="admin"
user_producer="password"
user_consumer="password";
};

# MirrorMaker Configuration
MirrorMaker –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

./infra/mirrormaker/consumer.cfg - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è consumer –¥–ª—è source –∫–ª–∞—Å—Ç–µ—Ä–∞

./infra/mirrormaker/producer.cfg - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è producer –¥–ª—è target –∫–ª–∞—Å—Ç–µ—Ä–∞

./infra/mirrormaker/start.sh - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞

# KSQL
KSQL - –¥–ª—è –ø—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:

./infra/ksql/init.sql

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞–º–∏
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ø–∏–∫–æ–≤
```bash
docker-compose up kafka-init
```
–†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤
```bash

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±—Ä–æ–∫–µ—Ä—É
docker exec -it kafka-0 kafka-topics \
--bootstrap-server kafka-0:1090 \
--command-config /etc/kafka/secrets/client.properties \
--create --topic test-topic \
--partitions 3 --replication-factor 2
```
# –£—Ç–∏–ª–∏—Ç—ã
–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ kafka-console-producer
```bash
docker exec -it kafka-0 kafka-console-producer \
--bootstrap-server kafka-0:1090 \
--topic test-topic \
--producer.config /etc/kafka/secrets/client.properties
```
–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ kafka-console-consumer
```bash
docker exec -it kafka-0 kafka-console-consumer \
--bootstrap-server kafka-0:1090 \
--topic test-topic \
--from-beginning \
--consumer.config /etc/kafka/secrets/client.properties
```
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose down
```
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes
```bash
docker-compose down -v
```
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```bash
docker-compose restart kafka-0
```


# –ú–æ–¥—É–ª–∏

## shopProducer

ShopProducerApplication - —ç—Ç–æ Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON-—Ñ–∞–π–ª–æ–≤ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –∏—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Apache Kafka —Ç–æ–ø–∏–∫. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö –≤ Schema Registry –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
Kafka Producer - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Kafka

Schema Registry Client - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö

File Watcher - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

JSON Parser - –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ JSON —Ñ–∞–π–ª–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
text
/etc/
‚îú‚îÄ‚îÄ data/          # –í—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö JSON —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ ready/         # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤  
‚îî‚îÄ‚îÄ schema/
‚îî‚îÄ‚îÄ product.json  # JSON —Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```java
private static final String INPUT_DIR = "/etc/data";
private static final String PROCESSED_DIR = "/etc/ready";
private static final String SCHEMA_PATH = "/etc/schema/product.json";
private static final long POLL_INTERVAL_MS = 5000L;
private static final long MESSAGE_DELAY_MS = 1000L;
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã Kafka (—á–µ—Ä–µ–∑ KafkaProperties):
KafkaProperties.getProducerProperties() - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–¥—é—Å–µ—Ä–∞

KafkaProperties.getSchemaRegistryUrl() - URL Schema Registry

KafkaProperties.getShopProducerTopicName() - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞

## –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

![img.png](img.png)


2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

![img_1.png](img_1.png)


## –ú–µ—Ç–æ–¥—ã
main(String[] args)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Ç–æ–∫: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥—é—Å–µ—Ä–∞ ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã ‚Üí –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

registerSchema()
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è JSON —Å—Ö–µ–º—ã –≤ Schema Registry

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç: CachedSchemaRegistryClient

–°—Ö–µ–º–∞: –ß–∏—Ç–∞–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ /etc/schema/product.json

loadSchemaFromFile()
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON —Å—Ö–µ–º—É –∫–∞–∫ —Å—Ç—Ä–æ–∫—É

getFileProducts(String path)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–∞—Ä—Å–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ JSON —Ñ–∞–π–ª–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç: Jackson ObjectMapper

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: List<Product> –∏–ª–∏ null –ø—Ä–∏ –æ—à–∏–±–∫–µ

publishingProducts(Producer<String, Product> producer)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

–õ–æ–≥–∏–∫–∞:

–ü–æ–∏—Å–∫ JSON —Ñ–∞–π–ª–æ–≤ –≤ –≤—Ö–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

–ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ Kafka

–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

–ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SLF4J –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π:

‚úÖ–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ {}: - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

–ü—É–±–ª–∏–∫—É–µ–º –≤ {}: {} - —É—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è - –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Kafka

–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞: {} - –ø—Ä–æ–±–ª–µ–º—ã —Å —á—Ç–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞


üöÄ –ó–∞–ø—É—Å–∫
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
Apache Kafka –∫–ª–∞—Å—Ç–µ—Ä —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º Schema Registry

SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSL)

SASL –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)

–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:
```bash
docker-compose ud -d shopproducer
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: –§–∞–π–ª –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

–û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Kafka: Retry –ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ Kafka Producer

–û—à–∏–±–∫–∏ Schema Registry: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º

–ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π: –õ–æ–≥–∏—Ä—É—é—Ç—Å—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞
 
## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: 1000 –º—Å

–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤: 5000 –º—Å

–†–∞–∑–º–µ—Ä –ø—É–ª–∞ Schema Registry: 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π Kafka –∫–ª–∞—Å—Ç–µ—Ä:

SASL/PLAIN –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ KafkaProperties

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–æ–≤: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏

–°—Ö–µ–º—ã: –ö—ç—à–∏—Ä—É—é—Ç—Å—è Schema Registry –∫–ª–∏–µ–Ω—Ç–æ–º

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –£–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ try-with-resources

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã Shop Producer Application –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–∞—à–∏–º Kafka –∫–ª–∞—Å—Ç–µ—Ä–æ–º.


# Shop Product Filter Stream

ShopProductFilterStreamApplication - —ç—Ç–æ Kafka Streams –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç KTable –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–π –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, –æ—Ç—Å–µ–∏–≤–∞—è –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–¢–æ–ø–æ–ª–æ–≥–∏—è –ø–æ—Ç–æ–∫–æ–≤:


![img_2.png](img_2.png)




## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
KStream - –ø–æ—Ç–æ–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ç–æ–ø–∏–∫–∞ shopTopic

KTable - —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ç–æ–ø–∏–∫–∞ blocked-products

Left Join - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

Filter - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```java
private static final ObjectMapper mapper = new ObjectMapper();
private static final AtomicLong blockedProductsCounter = new AtomicLong(0);
```

–¢–æ–ø–∏–∫–∏:
–í—Ö–æ–¥–Ω–æ–π —Ç–æ–ø–∏–∫: shopTopic - –ø–æ—Ç–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

–¢–æ–ø–∏–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤: blocked-products - KTable —Å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏

–í—ã—Ö–æ–¥–Ω–æ–π —Ç–æ–ø–∏–∫: products - –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã

### –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è KTable
   ```java
   KTable<String, String> blockedProductsTable = builder.table(
   KafkaProperties.getTopicBlockedProducts(),
   Consumed.with(Serdes.String(), Serdes.String()),
   Materialized.as("blocked-products-store")
   );
   ```
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π KTable
   –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

–ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤

–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
   –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:
   –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

Left Join —Å KTable –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π —Ç–æ–ø–∏–∫

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã
startStreamsProcessing()
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

–§—É–Ω–∫—Ü–∏–∏:

–°–æ–∑–¥–∞–Ω–∏–µ StreamsBuilder

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ KTable –∏ KStream

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

–ó–∞–ø—É—Å–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Kafka Streams

extractProductNameFromJson(JsonNode product)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ JSON

–ü–æ–ª—è –ø–æ–∏—Å–∫–∞: name, productName, product, title, itemName

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ò–º—è –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ null

cleanInput(String input)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û—á–∏—Å—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–§—É–Ω–∫—Ü–∏–∏:

–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON

–û–±—Ä–∞–±–æ—Ç–∫–∞ Avro magic bytes

startMetricsLogger(KafkaStreams streams)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ò–Ω—Ç–µ—Ä–≤–∞–ª: 30 —Å–µ–∫—É–Ω–¥

–ú–µ—Ç—Ä–∏–∫–∏: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤, –º–µ—Ç—Ä–∏–∫–∏ Kafka Streams

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:
>>> NEW PRODUCT ARRIVED <<< - –ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä

üîç JOINING PRODUCT WITH BLOCKED LIST - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

üéâ PRODUCT ALLOWED - —Ç–æ–≤–∞—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω

üö∑ PRODUCT BLOCKED - —Ç–æ–≤–∞—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

KTable –∏–∑–º–µ–Ω–µ–Ω–∏–π:
‚ûï BLOCKED PRODUCT ADDED/UPDATED - –¥–æ–±–∞–≤–ª–µ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä

üóëÔ∏è BLOCKED PRODUCT REMOVED - —É–¥–∞–ª–µ–Ω –∏–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

üìä CURRENT BLOCKED PRODUCTS COUNT - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:
üîÑ KAFKA STREAMS STATE CHANGE - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

üìà METRICS - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

üõë Shutting down streams application - graceful shutdown

## –ö–ª–∞—Å—Å ProcessingResult
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ Streams.

–ü–æ–ª—è:
productValue - –∏—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞

allowed - —Ñ–ª–∞–≥ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

reason - –ø—Ä–∏—á–∏–Ω–∞ —Ä–µ—à–µ–Ω–∏—è

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
State Management:
KTable Materialization: blocked-products-store

Atomic Counter: blockedProductsCounter –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É

Error Handling:
Uncaught Exception Handler: –õ–æ–≤–∏—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

Graceful Shutdown: 30-—Å–µ–∫—É–Ω–¥–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è

Data Validation: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

Performance:
Left Join: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π

Filter Early: –†–∞–Ω–Ω—è—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

Incremental Updates: KTable –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## –ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
–ó–∞–ø—É—Å–∫:
```bash
docker-compose ud -d shop-product-filter-stream
```

## client

–ú–æ–¥—É–ª—å client –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –ø—É–±–ª–∏–∫—É–µ—Ç –≤ Kafka –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

![img_3.png](img_3.png)

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

Kafka Producer - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ç–æ–ø–∏–∫ userQuery
Kafka Consumer - –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏–∑ —Ç–æ–ø–∏–∫–∞ user_recommendations
JPA Repository - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ PostgreSQL
KSQL Processing - –ø–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
REST Controller - API –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

## –¢–æ–ø–∏–∫–∏

–í—Ö–æ–¥–Ω–æ–π —Ç–æ–ø–∏–∫: userQuery - –ø–æ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
–¢–æ–ø–∏–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: user_recommendations - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
–í—ã—Ö–æ–¥–Ω–æ–π API: REST endpoints –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

## –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
   - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ UserQuery
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL —á–µ—Ä–µ–∑ UserQueryRepository
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ DTO –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Kafka —Ç–æ–ø–∏–∫ userQuery
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. KSQL –æ–±—Ä–∞–±–æ—Ç–∫–∞
4. –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫ user_recommendations
   - –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON –≤ UserRecommendation
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ in-memory –∫—ç—à (ConcurrentHashMap)
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:

‚úÖ Start work saveAndPublishUserQuery - –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏

‚úÖ User query saved to DB - —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

‚úÖ User query published to Kafka - —É—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è

Kafka —Å–æ–æ–±—â–µ–Ω–∏—è:

üì• Received recommendation for user - –ø–æ–ª—É—á–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

‚úÖ Processed recommendation for user - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞

–û—à–∏–±–∫–∏:

‚ùå Failed to publish user query - –æ—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

‚ùå Failed to parse recommendation - –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞


## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### State Management:

   - In-Memory Cache: ConcurrentHashMap –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   - Database Persistence: PostgreSQL –¥–ª—è –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - Kafka Offsets: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏—è–º–∏

### Error Handling:

   - Transaction Management: @Transactional –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –ë–î
   - Kafka Retries: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - Graceful Degradation: –†–∞–±–æ—Ç–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### Performance:

   - Async Processing: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Kafka
   - Connection Pooling: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
   - Batch Processing: KSQL –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### Security: 

   - SASL/SSL: –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Kafka
   - Input Validation: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
   - SQL Injection Protection: JPA –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## REST API

   - GET - /products?userId=5&query=–ö–æ–∂–∞–Ω—ã–π - –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
   - GET - /users/{userId}/recommendations - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   - GET - /debug/recommendations - –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—ç—à–µ

## –ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
–ó–∞–ø—É—Å–∫:
```bash
docker-compose ud -d client
```